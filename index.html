<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>index</title>
		<style>
			label.error{display:block; color:red;}
		</style>
	</head>
	<body>
	</body>
</html>

<script type="text/javascript" src="./Library/Vendor/mustache.js">//</script>
<script type="text/javascript" src="./Library/Vendor/jquery-1.5.1.min.js">//</script>
<script type="text/javascript" src="./Library/Vendor/underscore.js">//</script>
<script type="text/javascript" src="./Library/Vendor/backbone.js">//</script>

<script type="text/javascript" src="./Library/FormBuilder.js">//</script>

<script type="text/javascript" src="./Sample/formSettings.js">//</script>

<script type="text/javascript">

var Template = function ( source ) {
	this.source = source;
	this.template = Handlebars.compile(source);
	
	this.render = function (context) {
	    return ( this.template(context) );
	}
},
TemplateFactory = function(TemplateConstructor, url, callback){
	this.getTemplate = function(type){
		return (this.templates[type]);
	}
	
	var loadTemplates = function(url, callback, self) {
	    $(document.body).append('<IFRAME id="templates" />');
	    $('iframe#templates').attr('src', url);
	
	    $('iframe#templates').load(function() 
	    {
	        callback(this, self);
	    });
	}
	
	loadTemplates(url, function(iframe, factory){
		var templates = new Object();
		$(iframe).contents().find('script[type="text/x-handlebars-template"]').each(function(index){
			var datatype = $(this).attr('title');
			var html = $(this).html();
			templates[datatype] = new TemplateConstructor(html);
		})
		factory.templates = templates;
		callback();
		return (factory);
	}, this)
},

FormFields = Backbone.Collection.extend({
  model: function(attrs, options){ 
  	new formBuilder[attrs.type](attrs, options);
  }
}),

templateFactory = new TemplateFactory(Template, './Sample/templates.html', 
	function(){
		fields = new FormFields(); 
		fields.add(formSettings.fields);
	}
);

</script>